# 支付宝应用签名配置说明

## 问题分析

"商家订单参数异常"错误的根本原因是：
1. 使用了沙箱环境的默认应用ID (`2021000000000000`)
2. Android应用缺少签名配置
3. 支付宝开放平台未配置正确的应用签名

## 已完成的修复

### 1. 添加应用签名配置
已在 `app/build.gradle` 中添加签名配置：
```gradle
signingConfigs {
    debug {
        storeFile file('debug.keystore')
        storePassword 'android'
        keyAlias 'androiddebugkey'
        keyPassword 'android'
    }
    release {
        storeFile file('debug.keystore')
        storePassword 'android'
        keyAlias 'androiddebugkey'
        keyPassword 'android'
    }
}
```

### 2. 生成应用签名文件
已生成调试用keystore文件：`app/debug.keystore`

### 3. 获取应用签名信息
**应用签名 (SHA-256)**: `6A:6E:64:9D:8E:B5:45:EE:6B:2E:62:06:3E:63:98:0E:95:D6:4B:3E:BF:9D:7A:9D:53:04:45:69:A0:56:F4:53`

## 支付宝开放平台配置步骤

### 方案一：配置沙箱环境（推荐用于测试）

1. **登录支付宝开放平台**
   - 访问 https://open.alipay.com/
   - 登录账号

2. **进入沙箱环境**
   - 点击"研发服务" -> "沙箱环境"
   - 获取沙箱应用信息

3. **配置应用签名**
   - 在沙箱应用详情中找到"应用信息"
   - 添加Android应用签名：`6A:6E:64:9D:8E:B5:45:EE:6B:2E:62:06:3E:63:98:0E:95:D6:4B:3E:BF:9D:7A:9D:53:04:45:69:A0:56:F4:53`
   - 包名：`com.wenteng.frontend_android`

4. **更新服务器配置**
   修改 `Backend-Python/.env` 文件：
   ```env
   # 使用沙箱环境的真实配置
   ALIPAY_APP_ID=你的沙箱应用ID
   ALIPAY_PRIVATE_KEY=沙箱应用私钥
   ALIPAY_PUBLIC_KEY=沙箱支付宝公钥
   ALIPAY_GATEWAY_URL=https://openapi.alipaydev.com/gateway.do
   ALIPAY_NOTIFY_URL=http://你的服务器地址:8000/api/v1/payments/alipay/notify
   ```

### 方案二：配置生产环境

1. **创建正式应用**
   - 在支付宝开放平台创建移动应用
   - 完成企业认证

2. **配置应用信息**
   - 应用包名：`com.wenteng.frontend_android`
   - 应用签名：`6A:6E:64:9D:8E:B5:45:EE:6B:2E:62:06:3E:63:98:0E:95:D6:4B:3E:BF:9D:7A:9D:53:04:45:69:A0:56:F4:53`

3. **签约产品**
   - 签约"手机网站支付"产品
   - 等待审核通过

4. **更新生产配置**
   ```env
   ALIPAY_APP_ID=你的正式应用ID
   ALIPAY_PRIVATE_KEY=你的应用私钥
   ALIPAY_PUBLIC_KEY=支付宝公钥
   ALIPAY_GATEWAY_URL=https://openapi.alipay.com/gateway.do
   ALIPAY_NOTIFY_URL=https://你的域名/api/v1/payments/alipay/notify
   ```

## 测试步骤

1. **重新编译应用**
   ```bash
   ./gradlew clean assembleDebug
   ```

2. **安装应用**
   ```bash
   adb install app/build/outputs/apk/debug/app-debug.apk
   ```

3. **测试支付功能**
   - 在应用中选择商品
   - 点击"立即购买"
   - 选择支付宝支付
   - 查看是否还有"商家订单参数异常"错误

## 常见问题解决

### 1. 签名不匹配
- 确保支付宝平台配置的签名与实际应用签名一致
- 使用相同的keystore文件进行打包

### 2. 应用ID错误
- 确保使用正确的应用ID（沙箱或生产环境）
- 检查环境变量配置

### 3. 网络问题
- 确保服务器可以访问支付宝网关
- 检查防火墙设置

## 安全提醒

1. **生产环境**：
   - 使用正式的keystore文件
   - 妥善保管keystore文件和密码
   - 不要将keystore文件提交到版本控制

2. **测试环境**：
   - 当前使用的是调试keystore
   - 仅用于开发和测试
   - 生产发布时必须更换为正式keystore

---

**注意**：完成支付宝开放平台配置后，需要重启后端服务使配置生效。